// Block all Flatpak installation, removal, and modification operations
// for non-administrative users. This covers both system and user installs.

polkit.addRule(function(action, subject) {
  // Check if the user is *not* in the 'wheel' group (the default admin group)
  // Or if the user is *not* the root user ('root' is subject.user='0')
  if (subject.user != "0" && !subject.isInGroup("wheel")) {
    
    // List of Flatpak actions to block for standard users
    var flatpakActions = [
      // Actions required for system-wide installs
      "org.freedesktop.Flatpak.modify-system", 
      "org.freedesktop.Flatpak.modify-system-bus",
      
      // Actions required for *user-level* installs
      "org.freedesktop.Flatpak.modify-user",
      "org.freedesktop.Flatpak.override-shared" // For system overrides
    ];

    // Check if the current action is one of the blocked Flatpak actions
    if (flatpakActions.indexOf(action.id) !== -1) {
      // Return 'no' to deny the action without prompting for a password
      return polkit.Result.DENIED;
    }
  }
});